{{ define "title" }}{{ .Title }} | {{ .Site.Title }}{{ end }}

{{ define "main" }}
<div class="container">
    <div class="blog__grid">
        <div class="blog__posts">
            
            {{/* Get all pages in the blog section inside the scope */}}
            {{ $blogPages := where .Site.RegularPages "Section" "blog" }}

            {{ if gt (len $blogPages) 0 }}
                {{ $paginator := .Paginate $blogPages }}

                {{ range $paginator.Pages }}
                    <article class="blog__post">
                        {{ with .Params.image }}
                            <div class="blog__post-image">
                                <img src="{{ . | relURL }}" alt="{{ $.Title }}">
                            </div>
                        {{ else }}
                            <div class="blog__post-image">{{ .Params.icon | default "üìù" }}</div>
                        {{ end }}
                        
                        <div class="blog__post-content">
                            <div class="blog__post-meta">
                                <span>üìÖ {{ .Date.Format "Jan 02, 2006" }}</span>
                                {{ with .Params.author }}
                                    <span>üë§ {{ . }}</span>
                                {{ end }}
                            </div>
                            
                            <h2 class="blog__post-title">
                                <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                            </h2>
                            
                            <p class="blog__post-excerpt">
                                {{ with .Summary }}
                                    {{ . | plainify | truncate 300 }}
                                {{ else }}
                                    {{ .Content | plainify | truncate 300 }}
                                {{ end }}
                            </p>
                            
                            <a href="{{ .RelPermalink }}" class="blog__read-more">
                                {{ i18n "readMore" }}
                            </a>
                        </div>
                    </article>
                {{ end }}
                
                {{ if gt $paginator.TotalPages 1 }}
                    <div class="blog__pagination">
                        {{ if $paginator.HasPrev }}
                            <a href="{{ $paginator.Prev.URL }}">‚Üê {{ i18n "previous" }}</a>
                        {{ end }}
                        
                        <span>{{ i18n "page" }} {{ $paginator.PageNumber }} {{ i18n "of" }} {{ $paginator.TotalPages }}</span>
                        
                        {{ if $paginator.HasNext }}
                            <a href="{{ $paginator.Next.URL }}">{{ i18n "next" }} ‚Üí</a>
                        {{ end }}
                    </div>
                {{ end }}

            {{ else }}
                <p>No blog posts found.</p>
            {{ end }}

        </div>

        {{ partial "sidebar.html" . }}
    </div>
</div>
{{ end }}
